name: CI
on:
  push:
    tags:
      - '*.*.*'

jobs:
  build:
    name: Build
    runs-on: windows-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout/@v3
      - name: Get Tag
        id: get_tag
        uses: dawidd6/action-get-tag@v1
      - name: Download ClashSinicizationTool
        id: clash_sinicization_tool
        uses: robinraju/release-downloader@e3fd2c236128631471f3822b8e7c56e0838e87ed
        with:
          repository: "BoyceLig/ClashSinicizationTool"
          latest: true
          fileName: "*.7z"
          tarBall: false
          zipBall: false
          out-file-path: "downloads"
      - name: Unpack ClashSinicizationTool & Copy Project Files
        shell: pwsh
        run: |
          if (-not (Test-Path ./Build)) { New-Item -Path ./ -Name Build -ItemType Directory }
          7z x ./downloads/ClashSinicizationTool-${{ steps.clash_sinicization_tool.outputs.tag_name }}.7z -o"./Build"
          Copy-Item -Path ./ç¿»è¯‘è„šæœ¬.txt -Destination ./Build/ClashSinicizationTool/ -Recurse -Force
          Copy-Item -Path ./moment-with-CN.js -Destination ./Build/ClashSinicizationTool/ -Recurse -Force
      - name: Download Clash for Windows
        id: clash_for_windows
        uses: robinraju/release-downloader@v1.4
        with:
          repository: "Fndroid/clash_for_windows_pkg"
          tag: ${{ steps.get_tag.outputs.tag }}
          fileName: "Clash.for.Windows-${{ steps.get_tag.outputs.tag }}-win.7z"
          tarBall: false
          zipBall: false
          out-file-path: "downloads"
      - name: Unpack Clash for Windows & Sinicization
        shell: pwsh
        run: |
          7z x ./downloads/Clash.for.Windows-${{ steps.get_tag.outputs.tag }}-win.7z -o"./Build/Clash"
          ./Build/ClashSinicizationTool/CLI.exe -c ./Build/Clash -t ./Build/ClashSinicizationTool/ç¿»è¯‘è„šæœ¬.txt
      - name: Package Asar
        shell: pwsh
        run: |
          7z a -mx9 "./Build/app.7z" "./Build/Clash/resources/app.asar"
      - name: Create Release
        uses: ncipollo/release-action@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          name: Clash for Windows v${{ steps.get_tag.outputs.tag }} æ±‰åŒ–è¡¥ä¸
          prerelease: true
          draft: false
          artifacts: ./Build/app.7z
          body: |
            [![](https://img.shields.io/badge/Channel-blue?label=Telegram&logo=telegram)](https://t.me/ClashR_for_Windows_Channel) [![](https://img.shields.io/badge/Group-green?label=Telegram&logo=telegram)](https://t.me/+Se4RSc06w8QK1HiS)
            ## æ±‰åŒ–æ–¹æ³•ï¼š
            
            è§£å‹å‹ç¼©åŒ…åï¼Œè¯·è‡ªè¡Œæ›¿æ¢ä¸‹åˆ—è·¯å¾„ä¸­çš„ `app.asar` æ–‡ä»¶

            `Clash for Windows\resources\app.asar`

            ## ç›¸å…³æ¨èï¼š

            ### ç›¸å…³æ¨è1ï¼šOKåŠ é€Ÿ

            8.8æŠ˜ä¼˜æƒ å·ç ï¼šclash

            [OKåŠ é€Ÿ](http://o.okjiasu.com/auth/register?code=F9B0)
            [TGç¾¤ç»„ä¸€é”®ç›´è¾¾](https://t.me/okjiasu)
            [TGå…¬å‘Šæ¿ä¸€é”®ç›´è¾¾](https://t.me/okjiasuqi)

            ç‰¹è‰²å±æ€§ï¼š
            âœ…ä¸é™é€Ÿï¼Œä¸é™æ—¶ã€‚
            âœ…ä½¿ç”¨ä¸æ»¡æ„éšæ—¶ğŸ‰‘é€€æ¬¾ï¼ï¼ï¼
            âœ…å°Šé‡ç”¨æˆ·éšç§ï¼Œä¸ä¿ç•™ç”¨æˆ·ä½¿ç”¨è®°å½•ï¼ï¼ï¼
            âœ…å…è´¹æä¾›Netflixé«˜çº§è§†é¢‘ä¼šå‘˜è´¦å·ã€‚
            âœ…å…è´¹æä¾›iOSç¾åŒºidå†…å«å°ç«ç®­/åœˆXç­‰å¤šæ¬¾ä»˜è´¹è½¯ä»¶ã€‚
            è´­ä¹°å°ç«ç®­ã€Google voiceğŸ‘‰[ç¥é©¬æ‚è´§é“º](https://googlevoice.top/)


            ### ç›¸å…³æ¨è2ï¼šCherry VPN

            8æŠ˜ä¼˜æƒ å·ï¼šclash

            [Cherry VPN å®˜ç½‘](https://cherryvpn.net/auth/register?code=EO50)
            [è®¨è®ºç»„](https://t.me/cherrylink_vpn)
            [å…¬å‘Šæ¿ç›´è¾¾](https://t.me/cherrylink_channel)

            ç‰¹è‰²å±æ€§ï¼š
            âœ…å…¨SSéš§é“ä¸­è½¬èŠ‚ç‚¹.
            âœ…è½»æ¾å¸¦ä½ ç•…æ¸¸ä¸–ç•Œã€‚
            âœ…ä½¿ç”¨ä¸æ»¡æ„éšæ—¶ğŸ‰‘é€€æ¬¾ï¼ï¼ï¼
            âœ…å°Šé‡ç”¨æˆ·éšç§ï¼Œä¸ä¿ç•™ç”¨æˆ·ä½¿ç”¨è®°å½•ï¼ï¼ï¼
